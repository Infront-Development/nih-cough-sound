{% load static %}
{% load i18n %}<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Participation Consent</title>
        <!-- Responsive Design -->
        <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="HandheldFriendly" content="true">
        <meta name="description" content="">

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
		integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
        <link href="{% static 'fontawesome_free/css/all.min.css' %}" rel="stylesheet" type="text/css">
    
        <link rel="stylesheet" type="text/css" href="{% static 'css/consent.css' %}" />
        <link rel="stylesheet" type="text/css" href="{% static 'recording/css/style.css' %}" />

        <!-- <link rel="stylesheet" type="text/css" href="{% static 'css/general.css' %}" /> -->

        <script src="https://code.jquery.com/jquery-3.5.1.min.js"
		integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
		integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous">
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/js/bootstrap-select.min.js"></script>

        <script>
            $(document).ready(function(){
                $("#Modal").modal('show');
                $('#Modal').modal({
                    backdrop: 'static'
                });
            });
        </script>
    </head>
    
    <body>
    {% if messages %}
        {% for message in messages %}
            {% if 'error' in message.tags %}
                <div class="mt-3 alert alert-danger w-75 mx-auto" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            {% endif %}
            {% if 'success' in message.tags %}
                <div class="mt-3 alert alert-success w-75 mx-auto" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            {% endif %}
            {% if 'warning' in message.tags %}
                <div class="mt-3 alert alert-warning w-75 mx-auto" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            {% endif %}
        {% endfor %}
    {% endif %}
        <!-- Read Me modal -->
        <div class="modal fade bd-example-modal-lg" id="Modal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" data-backdrop="static">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">CONSENT TO PARTICIPATE IN RESEARCH:</h5>
                        <form class="form-inline ml-2" action="{% url 'set_language' %}" method="POST">
                                {% csrf_token %}
                                <input type="hidden" name="next" value="{{ redirect_to }}" >
                                <select class="form-control" name="language" id="language" onchange="this.form.submit()">
                                    {% get_current_language as LANGUAGE_CODE %}
                                    {% get_available_languages as LANGUAGES %}
                                    {% get_language_info_list for LANGUAGES as languages %}
                                    {% for language in languages %}
                                    <option value="{{ language.code }}"{% if language.code == LANGUAGE_CODE %} selected{% endif %}>
                                        {{ language.name_local }} ({{ language.code }})
                                    </option>
                                    {% endfor %}
                                </select>
                            </form>
                    </div>
                    <div class="modal-body">
                        <h6>
                            {% blocktrans %} TESTING THE PERFORMANCE OF A BREATH DAN COUGH SOUND ARTIFICIAL INTELLIGENCE (A.I.) FOR THE DETECTION OF
                            INFECTIOUS DISEASES, SUCH AS COVID-19 {% endblocktrans %}
                        </h6>
                        <p>
                            {% blocktrans %} If you AGREE, you can participate in a research conducted by DIGITAL HEALTH RESEARCH AND INNOVATION UNIT, INSTITUTE
                            FOR CLINICAL RESEARCH, MINISTRY OF HEALTH MALAYSIA AND SWINBURNE UNIVERSITY OF TECHNOLOGY SARAWAK.
                            Please read the whole page before continuing. You must be age 18 and above to participate. The information below provides a
                            summary of the research. Your participation in this research is voluntary and you can withdraw at any time simply by closing the
                            browser or going to a different page at any moment. {% endblocktrans %}
                            
                        </p>
                        <table>
                            <tr>
                                <th>
                                    {% trans "Institution" %}
                                </th>
                                <th>
                                    {% trans "Investigator" %}
                                </th>
                            </tr>
                            <tr>
                                <td>Institute for Clinical Research</td>
                                <td>William Law Kian Boon</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>Dr. Kalaiarasu M. Peariasamy</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>Dr. Mohd Aizuddin Bin Abdul Rahman</td>
                            </tr>
                            <tr>
                                <td>Swinburne University of Technology Sarawak</td>
                                <td>Prof. Patrick Then Hang Hui</td>
                            </tr>
                        </table>
                        <p>
            <button onclick="enableAgreeBtn()" class="btn btn-link" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">Read More</button>
            <div class="collapse" id="collapseExample">
                <div class="card card-body">
                            <strong>
                            {% trans "PURPOSE:" %}
                            </strong><br>
                            {% blocktrans %} In this study we will collect sample breath and cough sounds from healthy individuals, COVID-19 patients and other infectious diseases,
                            and try to distinguish them using an Artificial Intelligence. Total number of participants is estimated to be 2400 for each type of disease. {% endblocktrans %}
                        </p>
                        <p>
                           <strong>
                               {% trans "STUDY PROCEDURES:" %}
                            </strong><br>
                           {% blocktrans %} You will submit breath and cough data using website audio recordings that will start once you give your consent to participate by
                            clicking next, and will answer seven questions about yourself:
                            (1) Category of respondent
                            (2) Sex
                            (3) Age
                            (4) Medical conditions
                            (5) Smoking status
                            (6) Symptoms
                            (7) Date of diagnosis or test
                            The total participation time should be around 10 minutes.
                            You will record your breath and cough sound using the recording capability in this website and the sound will be captured and sent to
                            the study team for the use only for the purpose of research.
                            At the end of the recording, we will get for your approximate location as well. {% endblocktrans %}
                        </p>
                        <p>
                           <strong>{% trans "RISK, PRECAUTIONS & POTENTIAL DISCOMFORT:" %}</strong><br>
                           {% blocktrans %} Make sure no other persons are within 20 feet of you when recording your breath and cough. Make sure you are away from any source
                            of noises to avoid unclear or contaminated recordings. You may experience minimal discomfort when producing cough. However, this
                            will not cause any harm to you. {% endblocktrans %}
                        </p>
                        <p>
                            <strong>{% trans "POTENTIAL BENEFITS:" %}</strong><br>
                           {% blocktrans %} In participating in this research study, you will contribute to solving a very important world problem. Eventually, your participation will
                            contribute to the development of an automated infectious diseases screening web tool. {% endblocktrans %}
                        </p>
                        <p>
                            <strong>{% trans "CONFIDENTIALITY & PRIVACY:" %}</strong><br>
                            {% blocktrans %} Information from you will be limited to breath and cough recordings and answers to the seven questions. All data from the study will
                            be stored in a secure local data server where they will be protected with encryption at all times, only accessible to participating
                            researchers and organizations. We will keep a repository of the data after the study is completed so that we can use it for development
                            of similar Artificial Intelligence, for example, if another pandemic appears in the future.
        
                            Please after you’ve read all the information in this consent form, ask any questions via email to Law Kian Boon (dhri@crc.gov.my), the
                            Principal Coordinating Investigator about anything you do not understand before deciding whether or not to participate. There is no
                            compensation for participating in this study. You are not waiving any legal rights because of your participation in this research study.
                            If you have any questions about your right as a participant in this study, you may contact the Chairman or secretariat of the Medical
                            Research & Ethics Committee (MREC), Block A, Kompleks Institut Kesihatan Negara (NIH), No. 1, Jalan Setia Murni U13/52, Seksyen
                            U13 Bandar Setia Alam 40170 Shah Alam Selangor. Phone 03-3362 8100, Email nihsec@nih.gov.my
        
                            If you decide to participate, in the next page we will ask you to send your breath and cough sound after you enter answers to the seven
                            questions mentioned above. You will submit the breath and cough sound through the speaker of your mobile phone, laptop or
                            computer
        
                            Once you have read this page, please click "I Agree" if you give your consent to participate. {% endblocktrans %}
                        </p>
                    </div>
                </div>
            </div>
                    <div class="modal-footer">
                        <button type="button" id="agree-btn" class="btn btn-secondary" data-dismiss="modal" disabled>{% trans "Agree" %}</button>
                    </div>
                </div>
            </div>
        </div>


        <div class="record-menu">
            <h1 style="color:#ff8c00">Record Your Cough Three (3) Times</h1>
            <h1 style="color:#ff8c00">User ID:{{id}}</h1>
            <h5>(Force it if it doesn't come naturally)</h5>
            <h5>Click the button below to start recording and click again to stop</h5>
            
            <div class="wrapper">
                <button class="btn-lg btn-info" data-mdb-ripple-color="dark" id="recordButton"><i class="fas fa-microphone" .onclick="pass(reco)"></i> Record </button>
                <button class="btn-lg btn-danger ml-3" data-mdb-ripple-color="dark" id="stopButton"><i class="fas fa-stop"></i> Stop </button>


                <div class="recording-animation-wrapper">
                    <div id="recording-animation" class="recording-stop">
                        <div class="text-uppercase text-danger recording-text">RECORDING  </div>
                        <div class="blob"></div><span id="min">00</span>:<span id="sec">00</span>
                    </div>
                </div>
              
                <br><br><a href="{% url 'breathPage' %}" onclick="submitAllAudio(event)" class="btn-lg btn-warning">Next</a>

                 <br><br>
                 
                <table class="table table-hover" >
                <thead>
                    <tr>
                    <th scope="col">#</th>
                    <th scope="col" width="35%"style="text-align:right">Cough recording</th>
                    <th scope="col" width="50%">File name</th>
                    <th scope="col" width="10%">Delete</th>
                    </tr>
                </thead>
                </table>
                 <ol id="recordingsList" class="recordingsList"></ol>

                {% comment %} <button onclick="deleteLI()">Delete</button>  {% endcomment %}


            </div>
   
        </div>
        
    </body>

    <script src="https://cdn.rawgit.com/mattdiamond/Recorderjs/08e7abd9/dist/recorder.js"></script>
    <script src="{% static 'js/consent.js' %}"></script>
    <script src="{% static 'js/record.js' %}"></script>
    {% comment %} <script type="text/javascript">
    document.getElementById("stopButton").onclick = function () {
        location.href = "/form";
    };
</script> {% endcomment %}

<script>
    const ul = document.querySelector('.recordingsList');

    ul.addEventListener('click', function(e) {
    this.removeChild(e.target);
    })

    function enableAgreeBtn(event){
        const agree_btn = document.getElementById("agree-btn");

        if (agree_btn.disabled){
            agree_btn.disabled = false;
        }
    }

     var Clock = {
  totalSeconds: 0,
  start: function () {
    if (!this.interval) {
        var self = this;
        function pad(val) { return val > 9 ? val : "0" + val; }
        this.interval = setInterval(function () {
          self.totalSeconds += 1;

          document.getElementById("min").innerHTML = pad(Math.floor(self.totalSeconds / 60 % 60));
          document.getElementById("sec").innerHTML = pad(parseInt(self.totalSeconds % 60));
        }, 1000);
    }
  },

  reset: function () {
    Clock.totalSeconds = null; 
    clearInterval(this.interval);
    document.getElementById("min").innerHTML = "00";
    document.getElementById("sec").innerHTML = "00";
    delete this.interval;
  },
  pause: function () {
    clearInterval(this.interval);
    delete this.interval;
  },

  resume: function () {
    this.start();
  },

  restart: function () {
     this.reset();
     Clock.start();
  }
};


document.getElementById("recordButton").addEventListener("click", function () { Clock.start(); });
document.getElementById("stopButton").addEventListener("click", function () { Clock.pause(); });

</script>
</html>
